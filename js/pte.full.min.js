(function(a){function A(f,c,d,b){b={data:b||b===0||b===false?b:c?c.data:{},_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:G,nest:H,wrap:o,html:I,update:e};f&&a.extend(b,f,{nodes:[],parent:c});if(d){b.tmpl=d;b._ctnt=b._ctnt||b.tmpl(a,b);b.key=++s;(x.length?m:j)[s]=b}return b}function y(f,c,d){var b;d=d?a.map(d,function(k){return typeof k==="string"?f.key?k.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+f.key+'" $2'):k:y(k,f,k._ctnt)}):f;if(c)return d;d=d.join("");d.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(k,l,n,t){b=a(n).get();u(b);if(l)b=D(l).concat(b);if(t)b=b.concat(D(t))});return b?b:D(d)}function D(f){var c=document.createElement("div");c.innerHTML=f;return a.makeArray(c.childNodes)}function J(f){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(f).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(c,d,b,k,l,n,t){c=a.tmpl.tag[b];if(!c)throw"Unknown template tag: "+b;b=c._default||[];if(n&&!/\w$/.test(l)){l+=n;n=""}if(l){l=B(l);t=t?","+B(t)+")":n?")":"";t=n?l.indexOf(".")>-1?l+B(n):"("+l+").call($item"+t:l;n=n?t:"(typeof("+l+")==='function'?("+l+").call($item):("+l+"))"}else n=t=b.$1||"null";k=B(k);return"');"+c[d?"close":"open"].split("$notnull_1").join(l?"typeof("+l+")!=='undefined' && ("+l+")!=null":"true").split("$1a").join(n).split("$1").join(t).split("$2").join(k||b.$2||"")+"__.push('"})+
"');}return __;")}function E(f,c){f._wrap=y(f,true,a.isArray(c)?c:[i.test(c)?c:a(c).html()]).join("")}function B(f){return f?f.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function u(f){function c(C){function M(L){L+=d;r=l[L]=l[L]||A(r,j[r.parent.key+d]||r.parent)}var z,w=C,r,K;if(K=C.getAttribute(h)){for(;w.parentNode&&(w=w.parentNode).nodeType===1&&!(z=w.getAttribute(h)););if(z!==K){w=w.parentNode?w.nodeType===11?0:w.getAttribute(h)||0:0;if(!(r=j[K])){r=m[K];r=A(r,j[w]||m[w]);r.key=++s;j[s]=r}v&&
M(K)}C.removeAttribute(h)}else if(v&&(r=a.data(C,"tmplItem"))){M(r.key);j[r.key]=r;w=(w=a.data(C.parentNode,"tmplItem"))?w.key:0}if(r){for(z=r;z&&z.key!=w;){z.nodes.push(C);z=z.parent}delete r._ctnt;delete r._wrap;a.data(C,"tmplItem",r)}}var d="_"+v,b,k,l={},n,t,F;n=0;for(t=f.length;n<t;n++)if((b=f[n]).nodeType===1){k=b.getElementsByTagName("*");for(F=k.length-1;F>=0;F--)c(k[F]);c(b)}}function G(f,c,d,b){if(!f)return x.pop();x.push({_:f,tmpl:c,item:this,data:d,options:b})}function H(f,c,d){return a.tmpl(a.template(f),
c,d,this)}function o(f,c){var d=f.options||{};d.wrapped=c;return a.tmpl(a.template(f.tmpl),f.data,d,f.item)}function I(f,c){var d=this._wrap;return a.map(a(a.isArray(d)?d.join(""):d).filter(f||"*"),function(b){if(c)b=b.innerText||b.textContent;else{var k;if(!(k=b.outerHTML)){k=document.createElement("div");k.appendChild(b.cloneNode(true));k=k.innerHTML}b=k}return b})}function e(){var f=this.nodes;a.tmpl(null,null,null,this).insertBefore(f[0]);a(f).remove()}var g=a.fn.domManip,h="_tmplitem",i=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
j={},m={},q,p={key:0,data:{}},s=0,v=0,x=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,c){a.fn[f]=function(d){var b=[];d=a(d);var k,l,n;k=this.length===1&&this[0].parentNode;q=j||{};if(k&&k.nodeType===11&&k.childNodes.length===1&&d.length===1){d[c](this[0]);b=this}else{l=0;for(n=d.length;l<n;l++){v=l;k=(l>0?this.clone(true):this).get();a(d[l])[c](k);b=b.concat(k)}v=0;b=this.pushStack(b,f,d.selector)}d=q;q=null;a.tmpl.complete(d);
return b}});a.fn.extend({tmpl:function(f,c,d){return a.tmpl(this[0],f,c,d)},tmplItem:function(){return a.tmplItem(this[0])},template:function(f){return a.template(f,this[0])},domManip:function(f,c,d){if(f[0]&&a.isArray(f[0])){for(var b=a.makeArray(arguments),k=f[0],l=k.length,n=0,t;n<l&&!(t=a.data(k[n++],"tmplItem")););if(t&&v)b[2]=function(F){a.tmpl.afterManip(this,F,d)};g.apply(this,b)}else g.apply(this,arguments);v=0;q||a.tmpl.complete(j);return this}});a.extend({tmpl:function(f,c,d,b){var k=!b;
if(k){b=p;f=a.template[f]||a.template(null,f);m={}}else if(!f){f=b.tmpl;j[b.key]=b;b.nodes=[];b.wrapped&&E(b,b.wrapped);return a(y(b,null,b.tmpl(a,b)))}if(!f)return[];if(typeof c==="function")c=c.call(b||{});d&&d.wrapped&&E(d,d.wrapped);c=a.isArray(c)?a.map(c,function(l){return l?A(d,b,f,l):null}):[A(d,b,f,c)];return k?a(y(b,null,c)):c},tmplItem:function(f){var c;if(f instanceof a)f=f[0];for(;f&&f.nodeType===1&&!(c=a.data(f,"tmplItem"))&&(f=f.parentNode););return c||p},template:function(f,c){if(c){if(typeof c===
"string")c=J(c);else if(c instanceof a)c=c[0]||{};if(c.nodeType)c=a.data(c,"tmpl")||a.data(c,"tmpl",J(c.innerHTML));return typeof f==="string"?a.template[f]=c:c}return f?typeof f!=="string"?a.template(null,f):a.template[f]||a.template(null,i.test(f)?f:a(f)):null},encode:function(f){return(""+f).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){j=
{}},afterManip:function(f,c,d){var b=c.nodeType===11?a.makeArray(c.childNodes):c.nodeType===1?[c]:[];d.call(f,c);u(b);v++}})})(jQuery);
(function(){var a,A,y,D,J,E,B,u,G,H,o,I=function(e,g){return function(){return e.apply(g,arguments)}};o=this;a=o.jQuery;o.pte=u=u||{};(function(e){return e.fixThickbox=function(g){var h,i,j,m;h=g.jQuery;if(!(h===null||g.frames.length<1)){log("===== FIXING THICKBOX =====");m=o.options.pte_tb_width+30;j=o.options.pte_tb_height+38;i=h("#TB_window");if(!(i.width()>=m&&i.height()>=j)){log("THICKBOX: "+i.width()+" x "+i.height());i.css({"margin-left":0-m/2,width:m,height:j}).children("iframe").css({width:m});
return g.setTimeout(function(){if(!(h("iframe",i).height()>j)){h("iframe",i).css({height:j});log("THICKBOX: "+i.width()+" x "+i.height());return true}},1E3)}}}})(u);H=function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};A=function(){function e(g){this.message=g;this.date=new Date}e.prototype.toString=function(){var g,h,i,j,m,q,p;q=function(s,v){for(;(""+s).length<v;)s="0"+s;return s};i=this.date;p=q(i.getUTCFullYear(),4);h=q(i.getUTCMonth()+1,2);g=q(i.getUTCDate(),2);j=
q(i.getUTCHours(),2);m=q(i.getUTCMinutes(),2);q=q(i.getUTCSeconds(),2);switch(H(this.message)){case "string":i=this.message;break;default:i=a.toJSON(this.message)}return""+p+h+g+" "+j+":"+m+":"+q+" - ["+H(this.message)+"] "+i};return e}();(function(e){e.messages=[];e.log=function(g){if(!o.options.pte_debug)return true;try{e.messages.push(new A(g));console.log(g);a("#pte-log-messages textarea").filter(":visible").val(e.formatLog())}catch(h){}};e.formatLog=function(){var g,h,i,j,m;g="";m=e.messages;
i=0;for(j=m.length;i<j;i++){h=m[i];g+=""+h+"\n"}return g};e.parseServerLog=function(g){var h,i,j;log("===== SERVER LOG =====");if((g!=null?g.length:void 0)!=null&&g.length>0){i=0;for(j=g.length;i<j;i++){h=g[i];log(h)}}return true};e.sendToPastebin=function(g){return a.ajax({url:"http://dpastey.appspot.com/",data:{title:"PostThumbnailEditor Log",content:g,lexer:"text",format:"json",expire_options:"2592000"},dataType:"json",global:false,type:"POST",error:function(h,i,j){a("#pte-log").fadeOut("900");
alert(objectL10n.pastebin_create_error);log(h);log(i);return log(j)},success:function(h){a("#pte-log").fadeOut("900");return prompt(objectL10n.pastebin_url,h.url)}})};return true})(u);o.log=u.log;a(document).ready(function(e){e("#test").click(function(g){g.stopImmediatePropagation();return true});e("#pastebin").click(function(){return u.sendToPastebin(u.formatLog())});e("#clear-log").click(function(){u.messages=[];return e("#pte-log-messages textarea").val(u.formatLog())});e("#close-log").click(function(){return e("#pte-log").fadeOut("900")});
e("#pte-log-tools a").click(function(g){return g.preventDefault()});return e("body").delegate(".show-log-messages","click",function(g){g.preventDefault();e("#pte-log-messages textarea").val(u.formatLog());return e("#pte-log").fadeIn("900")})});(function(e){return e.admin=function(){var g,h,i,j,m,q;q="&TB_iframe=true&height="+o.options.pte_tb_height+"&width="+o.options.pte_tb_width;i=null;m=function(p){p=p||i||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+p+q};
g=function(p){return a('<a class="thickbox" href="'+m(p)+'">'+objectL10n.PTE+"</a>")};h=function(p){log("Start PTE...");if(o.parent.frames.length>0){log("Modifying thickbox...");I(function(){o.parent.tb_click();return true},this)();return p.stopPropagation()}};j=function(){var p;p=a("#imgedit-save-target-"+i);if((p!=null?p.size():void 0)<1){o.log("Edit Thumbnail Menu not visible, waiting for 300ms");o.setTimeout(j,300);return false}return p.append(g().click(h))};return function(){a(".media-item").each(function(p,
s){var v;v=s.id.replace("media-item-","");return g(v).css({"font-size":".8em","margin-left":"5px"}).click(h).appendTo(a("tr.image-size th.label",s))});if(imageEdit.open!=null){imageEdit.oldopen=imageEdit.open;imageEdit.open=function(p,s){i=p;imageEdit.oldopen(p,s);return j()}}return true}()}})(u);y=function(){function e(g,h){this.fn=g;this.timeout=h;this.doFunc=I(this.doFunc,this);this.timer=null}e.prototype.doFunc=function(){o.clearTimeout(this.timer);this.timer=o.setTimeout(this.fn,this.timeout);
return true};return e}();o.randomness=function(){return Math.floor(Math.random()*1000001).toString(16)};o.debugTmpl=function(e){log("===== TEMPLATE DEBUG DATA FOLLOWS =====");log(e);return true};D=function(e){e={id:e,action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};return a.ajax({url:ajaxurl,data:e,global:false,dataType:"json",success:J})};J=function(e){log("===== DELETE SUCCESSFUL, DATA DUMP FOLLOWS =====");log(e);return u.parseServerLog(e.log)};G=a({});a.fn.extend({move:function(e){e=
a.extend({direction:"left",speed:500,easing:"swing",toggle:true,callback:null,callbackargs:null},e);this.each(function(){return G.queue(I(function(g){var h,i,j;h=a(this);i=e.direction==="left"?-1:1;j=h.css("left")==="0px"?a(o).width()*i:0;if(h.is(":visible")){h.animate({left:j},e.speed,e.easing);h.hide(0,g)}else h.show(0,function(){return a(this).animate({left:j},e.speed,e.easing,g)});return true},this))});e.callback&&G.queue(function(g){e.callbackargs!=null?e.callback.apply(this,e.callbackargs):
e.callback.apply(this);return g()});return this},moveRight:function(e){e=a.extend(e,{direction:"right"});return this.move(e)},moveLeft:function(e){e=a.extend(e,{direction:"left"});return this.move(e)}});o.goBack=function(e){e!=null&&e.preventDefault();a("#stage2").moveRight();a("#stage1").moveRight({callback:function(){D(a("#pte-post-id").val());return a("#stage2").html("")}});return true};B=function(e,g){if(e===0)return g;for(;g>0;)if(e>g)e-=g;else g-=e;if(e<0||g<0)return null;return e};E=function(e,
g){var h,i,j,m;h=g.crop;m=g.width;j=g.height;h=+h;m=+m;j=+j;i=B(m,j);if(h!=null&&h>0){h=null;if((m!=null)>0&&(j!=null)>0)h=i!=null?""+m/i+":"+j/i:""+m+":"+j;if(e!=null&&h!=null&&h!==e)throw objectL10n.aspect_ratio_disabled;e=h}return e};u.functions={determineAspectRatio:E};(function(e){var g,h,i,j,m,q,p,s,v,x,f;e.editor=function(){p();i();f();h();j();m();g();q();return true};q=function(){var c,d;c=a("#pte-loading");d=function(){c.hide();return true};a("#pte-preview").load(d);c.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});
o.setTimeout(d,2E3);return true};p=function(){var c;c=new y(function(){var d;log("===== REFLOW =====");e.fixThickbox(o.parent);d=a("#pte-sizes").offset();d=a(o).height()-d.top-2;return a("#pte-sizes").height(d)},100);a(o).resize(c.doFunc).load(c.doFunc);a("#stage2, #stage3").css({left:a(o).width()});return true};i=function(){var c;c=function(d){d.delegate("tr","click",function(b){b.target.type!=="checkbox"&&a("input:checkbox",this).click();return true});return d.delegate("input:checkbox","click",
function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):a(this).parents("tr").first().addClass("selected");return true})};c(a("#stage2"));return c(a("#stage1"))};x=null;v={keys:true,minWidth:3,minHeight:3,handles:true,zIndex:1200,instance:true,onSelectEnd:function(c,d){return d.width&&d.width>0&&d.height&&d.height>0&&a(".pte-size").filter(":checked").size()>0?a("#pte-submit").removeAttr("disabled"):a("#pte-submit").attr("disabled",true)}};f=function(){return e.ias=
x=a("#pte-image img").imgAreaSelect(v)};s=function(c){log("===== SETTING ASPECTRATIO: "+c+" =====");x.setOptions({aspectRatio:c});return x.update()};h=function(){var c,d;d=new y(function(){log("===== CHECK SUBMIT BUTTON =====");if(a(".pte-confirm").filter(":checked").size()>0){log("ENABLE");a("#pte-confirm").removeAttr("disabled")}else{log("DISABLE");a("#pte-confirm").attr("disabled",true)}return true},50);c=new y(function(){var b;b=null;a("input.pte-size").filter(":checked").each(function(k,l){try{b=
E(b,thumbnail_info[a(l).val()])}catch(n){b=null;b!==x.getOptions().aspectRatio&&alert(n);return false}return true});s(b);v.onSelectEnd(null,x.getSelection());return true},50);a.extend(e.functions,{pteVerifySubmitButtonHandler:d});a("input.pte-size").click(c.doFunc);return a(".pte-confirm").live("click",function(){return d.doFunc()})};j=function(){var c;a("#pte-submit").click(function(){var d,b;b=x.getSelection();d=a("#pte-sizer").val();d={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images",
"pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),x:Math.floor(b.x1/d),y:Math.floor(b.y1/d),w:Math.floor(b.width/d),h:Math.floor(b.height/d)};log("===== RESIZE-IMAGES =====");log(d);x.setOptions({hide:true,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",true);a.getJSON(ajaxurl,d,c);return true});return c=function(d){log("===== RESIZE-IMAGES SUCCESS =====");log(d);e.parseServerLog(d.log);if(d.error!=null&&d.thumbnails==null)alert(d.error);else{a("#stage1").moveLeft();
a("#stage2").html(a("#stage2template").tmpl(d)).moveLeft({callback:e.functions.pteVerifySubmitButtonHandler.doFunc});return false}}};m=function(){var c;a("#pte-confirm").live("click",function(){var d,b;b={};a("input.pte-confirm").filter(":checked").each(function(k,l){var n;n=a(l).val();return b[n]=a("#pte-"+n+"-file").val()});d={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),"pte-confirm":b};log("===== CONFIRM-IMAGES =====");log(d);return a.getJSON(ajaxurl,
d,c)});return c=function(d){log("===== CONFIRM-IMAGES SUCCESS =====");log(d);e.parseServerLog(d.log);a("#stage2").moveLeft();a("#stage3").html(a("#stage3template").tmpl(d)).moveLeft();return false}};g=function(){var c,d;d=function(b){var k,l;b!=null&&b.preventDefault();b=(k=(l=b.data)!=null?l.selector:void 0)!=null?k:".pte-size";return a(b).filter(":checked").click()};c=function(b){var k,l;b!=null&&b.preventDefault();b=(k=b!=null?(l=b.data)!=null?l.selector:void 0:void 0)!=null?k:".pte-size";return a(b).not(":checked").click()};
a("#pte-selectors .all").click(c);a("#pte-selectors .none").click(d).click();a("#stage2").delegate("#pte-stage2-selectors .all","click",{selector:".pte-confirm"},c);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},d);return true};return a.extend(e.functions,{iasSetAR:s})})(u)}).call(this);
