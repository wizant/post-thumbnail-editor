(function(a){function B(b,c,f,d){d={data:d||d===0||d===false?d:c?c.data:{},_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:m,nest:n,wrap:v,html:s,update:w};b&&a.extend(d,b,{nodes:[],parent:c});if(f){d.tmpl=f;d._ctnt=d._ctnt||d.tmpl(a,d);d.key=++k;(A.length?x:q)[k]=d}return d}function E(b,c,f){var d;f=f?a.map(f,function(h){return typeof h==="string"?b.key?h.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+y+'="'+b.key+'" $2'):h:E(h,b,h._ctnt)}):b;if(c)return f;f=f.join("");f.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(h,i,o,t){d=a(o).get();l(d);if(i)d=I(i).concat(d);if(t)d=d.concat(I(t))});return d?d:I(f)}function I(b){var c=document.createElement("div");c.innerHTML=b;return a.makeArray(c.childNodes)}function F(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(c,f,d,h,i,o,t){c=a.tmpl.tag[d];if(!c)throw"Unknown template tag: "+d;d=c._default||[];if(o&&!/\w$/.test(i)){i+=o;o=""}if(i){i=G(i);t=t?","+G(t)+")":o?")":"";t=o?i.indexOf(".")>-1?i+G(o):"("+i+").call($item"+t:i;o=o?t:"(typeof("+i+")==='function'?("+i+").call($item):("+i+"))"}else o=t=d.$1||"null";h=G(h);return"');"+c[f?"close":"open"].split("$notnull_1").join(i?"typeof("+i+")!=='undefined' && ("+i+")!=null":"true").split("$1a").join(o).split("$1").join(t).split("$2").join(h||d.$2||"")+"__.push('"})+
"');}return __;")}function p(b,c){b._wrap=E(b,true,a.isArray(c)?c:[j.test(c)?c:a(c).html()]).join("")}function G(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function l(b){function c(H){function M(L){L+=f;r=i[L]=i[L]||B(r,q[r.parent.key+f]||r.parent)}var C,z=H,r,K;if(K=H.getAttribute(y)){for(;z.parentNode&&(z=z.parentNode).nodeType===1&&!(C=z.getAttribute(y)););if(C!==K){z=z.parentNode?z.nodeType===11?0:z.getAttribute(y)||0:0;if(!(r=q[K])){r=x[K];r=B(r,q[z]||x[z]);r.key=++k;q[k]=r}u&&
M(K)}H.removeAttribute(y)}else if(u&&(r=a.data(H,"tmplItem"))){M(r.key);q[r.key]=r;z=(z=a.data(H.parentNode,"tmplItem"))?z.key:0}if(r){for(C=r;C&&C.key!=z;){C.nodes.push(H);C=C.parent}delete r._ctnt;delete r._wrap;a.data(H,"tmplItem",r)}}var f="_"+u,d,h,i={},o,t,J;o=0;for(t=b.length;o<t;o++)if((d=b[o]).nodeType===1){h=d.getElementsByTagName("*");for(J=h.length-1;J>=0;J--)c(h[J]);c(d)}}function m(b,c,f,d){if(!b)return A.pop();A.push({_:b,tmpl:c,item:this,data:f,options:d})}function n(b,c,f){return a.tmpl(a.template(b),
c,f,this)}function v(b,c){var f=b.options||{};f.wrapped=c;return a.tmpl(a.template(b.tmpl),b.data,f,b.item)}function s(b,c){var f=this._wrap;return a.map(a(a.isArray(f)?f.join(""):f).filter(b||"*"),function(d){if(c)d=d.innerText||d.textContent;else{var h;if(!(h=d.outerHTML)){h=document.createElement("div");h.appendChild(d.cloneNode(true));h=h.innerHTML}d=h}return d})}function w(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}var D=a.fn.domManip,y="_tmplitem",j=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
q={},x={},g,e={key:0,data:{}},k=0,u=0,A=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){a.fn[b]=function(f){var d=[];f=a(f);var h,i,o;h=this.length===1&&this[0].parentNode;g=q||{};if(h&&h.nodeType===11&&h.childNodes.length===1&&f.length===1){f[c](this[0]);d=this}else{i=0;for(o=f.length;i<o;i++){u=i;h=(i>0?this.clone(true):this).get();a(f[i])[c](h);d=d.concat(h)}u=0;d=this.pushStack(d,b,f.selector)}f=g;g=null;a.tmpl.complete(f);
return d}});a.fn.extend({tmpl:function(b,c,f){return a.tmpl(this[0],b,c,f)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(b,c,f){if(b[0]&&a.isArray(b[0])){for(var d=a.makeArray(arguments),h=b[0],i=h.length,o=0,t;o<i&&!(t=a.data(h[o++],"tmplItem")););if(t&&u)d[2]=function(J){a.tmpl.afterManip(this,J,f)};D.apply(this,d)}else D.apply(this,arguments);u=0;g||a.tmpl.complete(q);return this}});a.extend({tmpl:function(b,c,f,d){var h=!d;
if(h){d=e;b=a.template[b]||a.template(null,b);x={}}else if(!b){b=d.tmpl;q[d.key]=d;d.nodes=[];d.wrapped&&p(d,d.wrapped);return a(E(d,null,d.tmpl(a,d)))}if(!b)return[];if(typeof c==="function")c=c.call(d||{});f&&f.wrapped&&p(f,f.wrapped);c=a.isArray(c)?a.map(c,function(i){return i?B(f,d,b,i):null}):[B(f,d,b,c)];return h?a(E(d,null,c)):c},tmplItem:function(b){var c;if(b instanceof a)b=b[0];for(;b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode););return c||e},template:function(b,c){if(c){if(typeof c===
"string")c=F(c);else if(c instanceof a)c=c[0]||{};if(c.nodeType)c=a.data(c,"tmpl")||a.data(c,"tmpl",F(c.innerHTML));return typeof b==="string"?a.template[b]=c:c}return b?typeof b!=="string"?a.template(null,b):a.template[b]||a.template(null,j.test(b)?b:a(b)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){q=
{}},afterManip:function(b,c,f){var d=c.nodeType===11?a.makeArray(c.childNodes):c.nodeType===1?[c]:[];f.call(b,c);l(d);u++}})})(jQuery);
(function(){var a,B,E,I,F,p,G=function(l,m){return function(){return l.apply(m,arguments)}};p=this;a=p.jQuery;p.pte=F=F||{};p.log=function(l){if(!p.debug_enabled)return true;try{console.log(l)}catch(m){alert(l)}return true};(function(l){return l.admin=function(){var m,n,v,s,w,D,y;y="&TB_iframe=true&height="+pte_tb_height+"&width="+pte_tb_width;s=null;D=function(j){j=j||s||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+j+y};m=function(j){return a('<a class="thickbox" href="'+
D(j)+'">'+objectL10n.PTE+"</a>")};v=function(j){var q,x,g;x=j.jQuery;if(x!==null){log("Got thickbox");g=pte_tb_width+40;q=pte_tb_height;y=x("#TB_window").css({"margin-left":0-g/2,width:g}).children("iframe").css({width:g});return j.setTimeout(function(){return x("iframe",y).css({height:q+100})},1E3)}};n=function(j){log("Start PTE...");if(p.parent.frames.length>0){log("Modifying thickbox...");G(function(){p.parent.tb_click();v(p.parent);return true},this)();return j.stopPropagation()}};w=function(){var j;
j=a("#imgedit-save-target-"+s);if((j!=null?j.size():void 0)<1){p.log("Edit Thumbnail Menu not visible, waiting for 300ms");p.setTimeout(w,300);return false}return j.append(m().click(n))};return function(){a(".media-item").each(function(j,q){var x;x=q.id.replace("media-item-","");return m(x).css({"font-size":".8em","margin-left":"5px"}).click(n).appendTo(a("tr.image-size th.label",q))});if(imageEdit.open!=null){imageEdit.oldopen=imageEdit.open;imageEdit.open=function(j,q){s=j;imageEdit.oldopen(j,q);
return w()}}return true}()}})(F);B=function(){function l(m,n){this.fn=m;this.timeout=n;this.doFunc=G(this.doFunc,this);this.timer=null}l.prototype.doFunc=function(){p.clearTimeout(this.timer);this.timer=p.setTimeout(this.fn,this.timeout);return true};return l}();p.randomness=function(){return Math.floor(Math.random()*1000001).toString(16)};p.debugTmpl=function(l){log(l);return true};p.goBack=function(l){l!=null&&l.preventDefault();return a("#stage2").animate({left:1200},500,"swing",function(){a(this).hide();
return a("#stage1").show(0,function(){return a(this).animate({left:0},500,"swing",function(){var m;log("okay cleanup");m={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};return a.ajax({url:ajaxurl,data:m,global:false,dataType:"json",success:function(n){return n.error!=null?log(n.error):log("Deleted tmp files")}})})})})};I=function(l,m){if(l===0)return m;for(;m>0;)if(l>m)l-=m;else m-=l;if(l<0||m<0)return null;return l};E=function(l,
m){var n,v,s,w;v=thumbnail_info[m];n=v.crop;w=v.width;s=v.height;n=+n;w=+w;s=+s;v=I(w,s);if(n!=null&&n>0){n=null;if((w!=null)>0&&(s!=null)>0)n=v!=null?""+w/v+":"+s/v:""+w+":"+s;if(l!=null&&n!=null&&n!==l)throw"Too many Aspect Ratios. Disabling";return n}};(function(l){var m,n,v,s,w,D,y,j,q,x;l.editor=function(){var g,e;x();v();q();n();s();w();m();g=a("#pte-loading");e=function(){log("Closing load screen");g.hide();return true};a("#pte-preview").load(e);g.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});
p.setTimeout(e,2E3);return true};x=function(){var g;g=new B(function(){var e;log("reflow called...");e=a("#pte-sizes").offset();e=a(p).height()-e.top-2;return a("#pte-sizes").height(e)},100);return a(p).resize(g.doFunc).load(g.doFunc)};v=function(){var g;g=function(e){e.delegate("tr","click",function(k){k.target.type!=="checkbox"&&a("input:checkbox",this).click();return true});return e.delegate("input:checkbox","click",function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):
a(this).parents("tr").first().addClass("selected");return true})};g(a("#stage2"));return g(a("#stage1"))};j=null;y={keys:true,minWidth:3,minHeight:3,handles:true,zIndex:1200,instance:true,onSelectEnd:function(g,e){if(e.width&&e.width>0&&e.height&&e.height>0&&a(".pte-size").filter(":checked").size()>0){log("Enabling button");return a("#pte-submit").removeAttr("disabled")}else{log("Disabling button");return a("#pte-submit").attr("disabled",true)}}};q=function(){return j=a("#pte-image img").imgAreaSelect(y)};
D=function(g){log("setting aspectRatio: "+g);j.setOptions({aspectRatio:g});return j.update()};n=function(){var g;g=new B(function(){var e;e=null;a("input.pte-size").filter(":checked").each(function(k,u){try{e=E(e,a(u).val())}catch(A){e=null;e!==j.getOptions().aspectRatio&&alert(A);return false}return true});D(e);y.onSelectEnd(null,j.getSelection());return true},50);return a("input.pte-size").click(g.doFunc)};s=function(){var g;a("#pte-submit").click(function(){var e,k;log("Clicked Submit...");k=j.getSelection();
e=a("#pte-sizer").val();e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),x:Math.floor(k.x1/e),y:Math.floor(k.y1/e),w:Math.floor(k.width/e),h:Math.floor(k.height/e)};log(e);j.setOptions({hide:true,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",true);a.getJSON(ajaxurl,e,g);return true});return g=function(e){log(e);if(e.error!=null&&e.thumbnails==null)alert(e.error);else{a("#stage1").animate({left:-a(p).width()},
500,"swing",function(){a(this).hide();a("#stage2").html(a("#stage2template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});return false}}};w=function(){var g;a("#pte-confirm").live("click",function(){var e,k;log("Confirming");k={};a("input.pte-confirm").filter(":checked").each(function(u,A){var b;b=a(A).val();return k[b]=a("#pte-"+b+"-file").val()});e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),
"pte-confirm":k};log(e);return a.getJSON(ajaxurl,e,g)});return g=function(e){log(e);a("#stage2").animate({left:-a(p).width()},500,"swing",function(){a(this).hide();a("#stage3").html(a("#stage3template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});return false}};return m=function(){var g,e;e=function(k){var u,A;k!=null&&k.preventDefault();k=(u=(A=k.data)!=null?A.selector:void 0)!=null?u:".pte-size";return a(k).filter(":checked").click()};g=function(k){var u,
A;k!=null&&k.preventDefault();k=(u=k!=null?(A=k.data)!=null?A.selector:void 0:void 0)!=null?u:".pte-size";return a(k).not(":checked").click()};a("#pte-selectors .all").click(g);a("#pte-selectors .none").click(e).click();a("#stage2").delegate("#pte-stage2-selectors .all","click",{selector:".pte-confirm"},g);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},e);return true}})(F)}).call(this);
